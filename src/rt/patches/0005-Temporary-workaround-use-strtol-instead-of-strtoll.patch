From c646a0321e98a090c7ee774b0c170a78dba5a70b Mon Sep 17 00:00:00 2001
From: Alexander Gavrilov <angavrilov@gmail.com>
Date: Tue, 15 Jul 2008 21:47:08 +0400
Subject: [PATCH] Temporary workaround: use strtoul instead of strtoll.

Also fixes a bug in negative pid handling (the 'av' part).
---
 source/winsup/utils/kill.cc |   14 +++++++++++---
 1 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/source/winsup/utils/kill.cc b/source/winsup/utils/kill.cc
index e21646f..e5bd692 100644
--- a/source/winsup/utils/kill.cc
+++ b/source/winsup/utils/kill.cc
@@ -241,9 +241,12 @@ main (int argc, char **argv)
 	case '?':
 	  if (gotasig)
 	    {
-	      pid = strtoll (argv[optind], &p, 10);
+	      pid = -(long long) strtoul (*av+1, &p, 10);
 	      if (pid < 0)
-		goto out;
+	        {
+		  optind = av - argv;
+		  goto out;
+		}
 	      usage ();
 	    }
 	  optreset = 1;
@@ -264,7 +267,12 @@ out:
   while (*argv != NULL)
     {
       if (!pid)
-	pid = strtoll (*argv, &p, 10);
+	{
+	  if (**argv == '-')
+	    pid = -(long long) strtoul (*argv+1, &p, 10);
+	  else
+	    pid = strtoul (*argv, &p, 10);
+	}
       if (*p != '\0'
           || (!force && (pid < LONG_MIN || pid > LONG_MAX))
           || (force && (pid <= 0 || pid > ULONG_MAX))) 
-- 
1.5.6.3.1089.g3c8b0

