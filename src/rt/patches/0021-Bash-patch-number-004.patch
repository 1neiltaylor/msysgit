From 1dcfd8e6a656e7e387c7b85aaa38c35c9bf795bc Mon Sep 17 00:00:00 2001
From: Thomas Braun <thomas.braun@byte-physics.de>
Date: Thu, 25 Sep 2014 00:56:00 +0200
Subject: [PATCH 21/35] Bash patch number 004

---
 msys/packages/bash/3.1/patchlevel.h | 2 +-
 msys/packages/bash/3.1/subst.c      | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/msys/packages/bash/3.1/patchlevel.h b/msys/packages/bash/3.1/patchlevel.h
index de42a3d..06c6c1c 100644
--- a/msys/packages/bash/3.1/patchlevel.h
+++ b/msys/packages/bash/3.1/patchlevel.h
@@ -25,6 +25,6 @@
    regexp `^#define[ 	]*PATCHLEVEL', since that's what support/mkversion.sh
    looks for to find the patch level (for the sccs version string). */
 
-#define PATCHLEVEL 3
+#define PATCHLEVEL 4
 
 #endif /* _PATCHLEVEL_H_ */
diff --git a/msys/packages/bash/3.1/subst.c b/msys/packages/bash/3.1/subst.c
index 1b538aa..d70fcb1 100644
--- a/msys/packages/bash/3.1/subst.c
+++ b/msys/packages/bash/3.1/subst.c
@@ -2201,7 +2201,7 @@ do_compound_assignment (name, value, flags)
   if (mklocal && variable_context)
     {
       v = find_variable (name);
-      if (v == 0 || array_p (v) == 0)
+      if (v == 0 || array_p (v) == 0 || v->context != variable_context)
         v = make_local_array_variable (name);
       v = assign_array_var_from_string (v, value, flags);
     }
-- 
2.1.0.msysgit.0

